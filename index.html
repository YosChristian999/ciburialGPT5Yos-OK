<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- CSP yang aman untuk CDN, Snap Midtrans, dan API kamu -->
  <meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  img-src 'self' data: https:;
  media-src 'self' https: blob:;
  style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com;
  font-src  'self' data: https://fonts.gstatic.com;
  script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://app.sandbox.midtrans.com https://app.midtrans.com;
connect-src 'self' https://api.sandbox.midtrans.com https://api.midtrans.com https://app.sandbox.midtrans.com https://app.midtrans.com https://cdn.jsdelivr.net;
frame-src https://app.sandbox.midtrans.com https://app.midtrans.com;
  base-uri 'self';
  object-src 'none';
  upgrade-insecure-requests;
">


  <title>Villa Ciburial Puncak — Sewa Villa, Pembayaran Aman Midtrans</title>
  <meta name="description" content="Sewa villa di Ciburial Puncak. Kolam renang, view pegunungan, pembayaran aman Midtrans.">

  <link rel="icon" href="/favicon.ico" type="image/png/ico">


  <!-- CSS eksternal -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <!-- CSS project -->
  <link href="assets/css/style.css" rel="stylesheet">
</head>

<body class="bg-dark text-light" style="font-family:'Poppins',system-ui,Segoe UI,Arial">

  <!-- Ticker -->
  <div class="ticker py-2">
    <div class="container small text-info-emphasis">
      ✨ Selamat Datang di Sewa Villa Ciburial Puncak · Pembayaran aman Midtrans (BCA, BRI, Mandiri, DANA, OVO) · Budget custom dapat kita sesuaikan ✨
    </div>
  </div>

  <!-- NAV -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-nav sticky-top border-bottom border-opacity-25">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="https://sewavilla.ciburialpuncak.com/index.html" title="Beranda">
        <img src="assets/images/logo.png" alt="Logo" width="28" height="28">
        <span class="fw-bold">Ciburial Puncak</span>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"
              aria-controls="mainNav" aria-expanded="false" aria-label="Buka navigasi">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav ms-auto gap-lg-2">
          <li class="nav-item"><a class="nav-link" href="/about.html">Tentang Kami</a></li>
          <li class="nav-item"><a class="nav-link" id="navVillaLink" href="#quickModal">Villa Kami</a></li>
          <li class="nav-item"><a class="nav-link" href="/booking.html">Booking</a></li>
          <li class="nav-item"><a class="nav-link" href="#payment">Pembayaran</a></li>
          <li class="nav-item"><a class="nav-link" href="/contact.html">Kontak</a></li>
          <li class="nav-item"><a class="nav-link" href="/login.html">Login</a></li>
          <li class="nav-item"><a class="nav-link text-warning" href="/admin.html">Admin</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="hero d-grid align-content-center text-center position-relative" style="min-height:72vh">
    <div id="heroParticles" style="position:absolute;inset:0;z-index:0;pointer-events:none"></div>
    <div class="container position-relative" style="z-index:1" data-aos="fade-up">
      <h1 class="display-5 fw-bold mb-2">Sewa Villa Terpercaya di Ciburial Puncak</h1>
      <p class="lead text-light-emphasis mx-auto" style="max-width:860px">
        Fasilitas premium, kolam renang, view pegunungan. Pembayaran aman melalui Midtrans.
        Mulai jelajahi villa yang cocok untuk keluarga maupun acara komunitas lainnya.
      </p>
      <div class="d-flex gap-2 justify-content-center mt-3">
        <button class="btn btn-info px-4" id="btnJelajahi" type="button">Jelajahi Villa</button>
        <a class="btn btn-outline-light px-4" href="#payment">Metode Pembayaran</a>
      </div>
    </div>
  </header>

  <!-- Featured (1 kartu) -->
  <section id="featured" class="container my-5" data-aos="fade-up">
    <h2 class="text-center text-info mb-4">Villa Pilihan Terbaik</h2>

    <div class="mx-auto" style="max-width:820px">
      <article class="card shadow-sm featured-card qm-card">
        <img class="card-img-top cover"
             src="assets/BGHero.jpg"
             alt="Villa Ciburial Puncak"
             onerror="this.onerror=null;this.src='/assets/images/pleaceholder.jpg'">
        <div class="card-body text-center">
          <h3 class="h4 mb-2">Villa Ciburial Puncak</h3>
          <p class="text-muted small mb-3">
            Koleksi villa premium dengan fasilitas lengkap dan pemandangan menakjubkan. Pilih villa sesuai kebutuhan Anda.
          </p>
          <button class="btn btn-info btn-lg px-4" id="btnOpenQuick">Lihat Detail Villa</button>
          <div class="mt-3">
            <small class="text-muted">Pembayaran Aman via Midtrans</small>
          </div>
        </div>
      </article>
    </div>
  </section>

  <!-- PAYMENT -->
  <section id="payment" class="container py-4" data-aos="fade-up">
    <h2 class="h4 fw-bold mb-3">Metode Pembayaran Aman</h2>
    <div class="bg-body-tertiary rounded-4 p-3 border border-opacity-25">
      <p class="mb-1">Pembayaran via Midtrans: Transfer Bank (BCA/BRI/BNI/Mandiri), Kartu, dan E-Wallet (DANA/OVO/GoPay).</p>
      <small class="text-secondary">Konfirmasi otomatis & real-time.</small>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="py-4 mt-4 bg-nav border-top border-opacity-25">
    <div class="container d-flex flex-wrap justify-content-between gap-2 small">
      <div>© 2025 Ciburial Puncak</div>
      <div class="text-secondary">Powered by Midtrans</div>
    </div>
  </footer>

  <!-- WhatsApp floating -->
  <a class="wa-float" href="https://wa.me/6285213267896" target="_blank" rel="noopener"
     aria-label="Chat WhatsApp" title="Chat WhatsApp">
    <svg viewBox="0 0 32 32" width="24" height="24" fill="currentColor" aria-hidden="true">
      <path d="M19.11 17.39c-.26-.13-1.52-.75-1.76-.83-.24-.09-.41-.13-.58.13s-.67.83-.82 1c-.15.17-.3.19-.56.06-.26-.13-1.08-.4-2.06-1.28-.76-.68-1.27-1.52-1.42-1.78-.15-.26-.02-.4.11-.53.11-.11.26-.3.39-.45.13-.15.17-.26.26-.43.09-.17.04-.32-.02-.45-.06-.13-.58-1.39-.79-1.9-.21-.51-.43-.44-.58-.45-.15-.01-.32-.01-.49-.01s-.45.06-.69.32c-.24.26-.91.89-.91 2.17 0 1.28.93 2.52 1.06 2.7.13.17 1.84 2.81 4.46 3.94.62.27 1.1.43 1.47.55.62.2 1.19.17 1.64.1.5-.07 1.52-.62 1.74-1.23.22-.61.22-1.13.15-1.23-.07-.1-.24-.16-.5-.29zM16 3C8.83 3 3 8.83 3 16c0 2.31.62 4.48 1.7 6.35L3 29l6.83-1.78A12.9 12.9 0 0 0 16 29c7.17 0 13-5.83 13-13S23.17 3 16 3z"/>
    </svg>
  </a>

  <!-- Quick Modal (GRID 11 VILLA + filter toolbar) -->
  <div class="modal fade" id="quickModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content bg-body">
        <div class="modal-header">
          <h5 class="modal-title">Pilih Villa Favorit Anda</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
        </div>

        <div class="modal-body">
          <!-- (POIN 3) Toolbar filter & search -->
          <div class="row g-2 align-items-end mb-3">
            <div class="col-12 col-md">
              <label class="form-label small">Cari nama/teks</label>
              <input type="search" class="form-control" id="fText" placeholder="mis. pemandangan, kolam, modern" />
            </div>
            <div class="col-6 col-md-2">
              <label class="form-label small">Harga min</label>
              <input type="number" class="form-control" id="fMin" min="0" placeholder="0" />
            </div>
            <div class="col-6 col-md-2">
              <label class="form-label small">Harga max</label>
              <input type="number" class="form-control" id="fMax" min="0" placeholder="99999999" />
            </div>
            <div class="col-6 col-md-2">
              <label class="form-label small">Kapasitas ≥</label>
              <input type="number" class="form-control" id="fCap" min="0" placeholder="0" />
            </div>
            <div class="col-6 col-md-2 d-grid">
              <button class="btn btn-outline-secondary" id="fReset">Reset</button>
            </div>
          </div>

          <!-- Grid (skeleton lalu data) -->
          <div id="qmGrid" class="row g-3"><!-- diisi via JS --></div>

          <!-- (POIN 5) Tombol lihat semua -->
          <div class="text-center mt-3">
            <!-- <a href="/ciburial/booking.html#vlist" class="btn btn-outline-info">Lihat semua villa</a> -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@3/tsparticles.bundle.min.js"></script>

  <script>
    // ===== INIT ANIM =====
  AOS.init({ duration: 700, once: true });
  </script>
  <script>
  // ===== Helpers =====
  const rupiah = n => 'Rp ' + Number(n || 0).toLocaleString('id-ID');
  window.basePath = window.basePath || (() => location.pathname.replace(/[^\/]+$/, ''));


  function imgFallback(img) {
    // urutan fallback: alt1 -> alt2 -> placeholder
    if (img.dataset.try1!=='1' && img.dataset.alt1) { img.dataset.try1='1'; img.src = img.dataset.alt1; return; }
    if (img.dataset.try2!=='1' && img.dataset.alt2) { img.dataset.try2='1'; img.src = img.dataset.alt2; return; }
    img.src = basePath() + 'assets/images/pleaceholder.jpg';
  }

  // Pemetaan alternatif cover per id (opsional, bisa kamu lengkapi)
  const COVER_BY_ID = {
    1:'Villa1Arikokena.png', 2:'Villa2Tiger.png', 3:'Villa3Cahaya.png',
    4:'Villa4BataCCitra.png', 5:'Villa5BataAgricon.png', 6:'Villa6Dinar3.png',
    7:'Villa7Yangtiq.png', 8:'Villa8HDO.jpg', 9:'Villa9Archie.jpg',
    10:'Villa10Rick.png', 11:'Villa11Zambrud.jpg'
  };

  function coverCandidates(v) {
    const c = [];
    if (v.url_gambar) {
      const p = String(v.url_gambar).replace(/^\/*/, ''); // buang leading slash ganda
      c.push(basePath() + p);
    }
    if (COVER_BY_ID[v.id]) c.push(basePath() + 'assets/images/VillaPic/' + COVER_BY_ID[v.id]);
    c.push(basePath() + 'assets/images/pleaceholder.jpg');
    return c;
  }

  // ===== Data state =====
  let RAW_VILLAS = [];   // dari server
  let VILLAS = [];       // setelah filter

  // ===== Fetch Villas (dengan error handling) =====
  async function fetchVillas() {
    const url = '/backend/api/villas/list.php';
    const res = await fetch(url, { cache: 'no-store' });
    const text = await res.text();
    let j;
    try { j = JSON.parse(text); }
    catch { throw new Error('list.php bukan JSON: ' + text.slice(0, 200)); }
    if (j.ok === false) throw new Error(j.error || 'Gagal memuat data');
    // dukung 2 bentuk: {ok:true,villas:[...]} atau langsung array
    return Array.isArray(j) ? j : (j.villas || []);
  }

  // ===== Skeleton =====
  function renderSkeleton() {
    const wrap = document.getElementById('qmGrid');
    const items = Array.from({ length: 6 }).map(() => `
      <div class="col-12 col-md-6 col-lg-4">
        <article class="card qm-card h-100 loading">
          <div class="cover skeleton" style="height:180px"></div>
          <div class="card-body">
            <div class="skeleton mb-2" style="height:20px;width:70%"></div>
            <div class="skeleton mb-2" style="height:14px;width:90%"></div>
            <div class="skeleton mb-2" style="height:14px;width:85%"></div>
            <div class="d-flex justify-content-between">
              <div class="skeleton" style="height:16px;width:100px"></div>
              <div class="skeleton" style="height:32px;width:90px;border-radius:6px"></div>
            </div>
          </div>
        </article>
      </div>
    `).join('');
    wrap.innerHTML = items;
  }

  // ===== Render grid =====
  function renderGrid(list) {
    const wrap = document.getElementById('qmGrid');
    if (!list.length) {
      wrap.innerHTML = `<div class="col-12"><div class="alert alert-warning mb-0">Data villa belum tersedia.</div></div>`;
      return;
    }
    wrap.innerHTML = list.map(v => {
      const cands = coverCandidates(v);
      const first = cands[0];
      const alt1  = cands[1] || '';
      const alt2  = cands[2] || '';
      return `
        <div class="col-12 col-md-6 col-lg-4">
          <article class="card qm-card h-100">
            <img class="cover" src="${first}" data-alt1="${alt1}" data-alt2="${alt2}"
                 alt="${(v.nama_villa || v.nama || 'Villa')}" onerror="imgFallback(this)">
            <div class="card-body">
              <h6 class="mb-1">${v.nama_villa || v.nama || 'Villa'}</h6>
              <p class="small text-secondary mb-3">${(v.deskripsi || '').slice(0, 150)}</p>
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-info fw-semibold">${rupiah(v.harga_per_malam || v.harga)}/malam</span>
                <a class="btn btn-info btn-sm" href="${basePath()}detail.html?villa=${encodeURIComponent(v.id)}">Pilih Villa Ini</a>
              </div>
            </div>
          </article>
        </div>`;
    }).join('');
  }

  // ===== Filter =====
  function applyFilter() {
    const q   = document.getElementById('fText')?.value?.toLowerCase() || '';
    const min = Number(document.getElementById('fMin')?.value || 0);
    const max = Number(document.getElementById('fMax')?.value || 0);
    const cap = Number(document.getElementById('fCap')?.value || 0);

    VILLAS = RAW_VILLAS.filter(v => {
      const nama = (v.nama_villa || v.nama || '').toLowerCase();
      const desk = (v.deskripsi || '').toLowerCase();
      const harga = Number(v.harga_per_malam || v.harga || 0);
      const kapas = Number(v.kapasitas_maksimal || v.kapasitas || 0);

      if (q && !(nama.includes(q) || desk.includes(q))) return false;
      if (min && harga < min) return false;
      if (max && harga > max) return false;
      if (cap && kapas < cap) return false;
      return true;
    });

    renderGrid(VILLAS);
  }

  // ===== Event binding =====
  (function bindEvents() {
    document.getElementById('fText')?.addEventListener('input', applyFilter);
    ['fMin','fMax','fCap'].forEach(id => {
      document.getElementById(id)?.addEventListener('change', applyFilter);
    });
    document.getElementById('fReset')?.addEventListener('click', () => {
      ['fText','fMin','fMax','fCap'].forEach(id => { const el = document.getElementById(id); if (el) el.value=''; });
      applyFilter();
    });

    // Buka modal via tombol
    const showModal = () => new bootstrap.Modal('#quickModal').show();
    document.getElementById('btnJelajahi')?.addEventListener('click', showModal);
    document.getElementById('btnOpenQuick')?.addEventListener('click', showModal);
    document.getElementById('navVillaLink')?.addEventListener('click', (e) => { e.preventDefault(); showModal(); });

    // Saat modal mau dibuka: load data
    const modalEl = document.getElementById('quickModal');
    modalEl?.addEventListener('show.bs.modal', async () => {
      try {
        renderSkeleton();
        RAW_VILLAS = await fetchVillas();
        VILLAS = RAW_VILLAS.slice(0);
        applyFilter();
      } catch (e) {
        console.error(e);
        document.getElementById('qmGrid').innerHTML =
          `<div class="col-12"><div class="alert alert-danger mb-0">Gagal memuat data villa. ${e.message}</div></div>`;
      }
    });
  })();
</script>
<script>
// basePath sudah didefinisikan di atas; jangan dideklar ulang.

// (opsional) tombol “Lihat semua” kalau nanti dipakai
document.getElementById('btnAll')?.addEventListener('click', (e)=>{
  e.preventDefault();
  location.href = basePath() + 'booking.html#vlist';
});

// 3b) Penting: taruh buildSlides DI DALAM <script>, bukan di luar.
window.buildSlides = function(urls){
  const wrap = document.getElementById('slides');
  if (!wrap) return;
  wrap.innerHTML = (urls || []).map(u => `
    <img src="${u}"
         onerror="this.onerror=null;this.src='${basePath()}assets/images/pleaceholder.jpg'"
         alt="Foto villa"
         class="img-fluid rounded-3 mb-2"/>
  `).join('');
};
</script>

  

</body>
</html> 

